// WS handler
deny: ("\\\\";"exit";"top";"kill";"spawn";"set";"load");
peval: {[expr]
    e: ,/ss[expr;]'deny;
    $[0=#e;eval parse expr;'"Operation is not permitted in a web REPL mode"]
};
.webrepl.run: {
    spawn {
        ws: reagent[`listener;"0.0.0.0:5100";{0N!"ws listener dropped"}];
        react[{[x:ws]
            spawn[{[sock]
                h: reagent[`ws;sock];
                // redefine stdout
                1:[{h[x]}];
                react[{[x:h]
                    r:@[{repr peval x};"c"$x;{format["%";"c"$x]}];
                    b:"x"$r;
                    $[150<#b;
                        h[("c"$50#b),".."];
                        h[r]]
                }]
            };x]
        }]
    }
};