// WS handler
\c 120 25;
deny: ("\\\\\\\\";"exit";"top";"kill";"spawn";"set";"load";"show";"getenv";"setenv";"argv");
peval: {[expr]
    e: ,/ss[expr;]'deny;
    $[0=#e;eval parse expr;'"Operation is not permitted in a web REPL mode"]
};
ps1: {println["Welcome to ThePlatform v1.0.0\n(Web REPL - strict mode)\n-----------------------------"]};
.webrepl.run: {
    spawn {
        ws: reagent[`listener;"0.0.0.0:45101";{0N!"ws listener dropped"}];
        react[{[x:ws]
            spawn[{[sock]
                h: reagent[`ws;sock];
                // redefine stdout
                1:[{h[x]}];
                react[{[x:h]
                    cli: h;
                    @[{
                        e: peval x;
                        if [~0N0~e] { cli[repr e] }
                      };
                      "c"$x;
                      {println["** % error: `%`\n%";x`kind;x`call;x`message]}
                    ]
                }]
            };x]
        }]
    }
};